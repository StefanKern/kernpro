<div class="scraped-sites">
  <div class="scraped-sites__header">
    <h1>Scraped Job Sites</h1>
    <button mat-raised-button color="warn" (click)="signOut()">
      <mat-icon>logout</mat-icon>
      Sign Out
    </button>
  </div>

  @if (scrapedSites$ | async; as sites) {
    @if (sites.length === 0) {
      <div class="scraped-sites__empty-state">
        <mat-icon>inbox</mat-icon>
        <h2>No scraped sites yet</h2>
        <p>Run the scraper to add job postings to this list</p>
      </div>
    } @else {
      <div class="scraped-sites__grid">
        @for (site of sites; track site.id) {
          <mat-card class="site-card">
            <mat-card-header class="site-card__header">
              <mat-card-title>
                <div class="site-card__header-info">
                  <mat-icon>work</mat-icon>
                  <span class="site-card__hostname">{{ getHostname(site.url) }}</span>
                </div>
              </mat-card-title>
              <mat-card-subtitle>
                <div class="site-card__meta">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ formatTimestamp(site.timestamp) }}</span>
                </div>
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <div class="site-card__url-container">
                <mat-icon>link</mat-icon>
                <a [href]="site.url" target="_blank" rel="noopener">
                  {{ site.url }}
                </a>
              </div>

              <div class="site-card__stats">
                @if (site.metadata?.contentLength) {
                  <mat-chip>
                    <mat-icon>description</mat-icon>
                    {{ formatBytes(site.metadata?.contentLength) }}
                  </mat-chip>
                }
                @if (site.metadata?.storageLocation) {
                  <mat-chip>
                    <mat-icon>cloud</mat-icon>
                    Cloud Storage
                  </mat-chip>
                }
              </div>
            </mat-card-content>

            <mat-card-actions class="site-card__actions">
              <button mat-button (click)="openUrl(site.url)">
                <mat-icon>open_in_new</mat-icon>
                Open Original
              </button>
              @if (site.metadata?.storageLocation) {
                <button mat-button disabled>
                  <mat-icon>download</mat-icon>
                  View Scraped
                </button>
              }
              <button mat-button color="warn" (click)="deleteSite(site)">
                <mat-icon>delete</mat-icon>
                Delete
              </button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  } @else {
    <div class="scraped-sites__loading-state">
      <mat-spinner></mat-spinner>
      <p>Loading scraped sites...</p>
    </div>
  }
</div>
